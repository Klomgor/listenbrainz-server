{% macro render_entity_link (entity, mbid, name) %}
  {%- if mbid is defined and mbid is not none -%}
    <a href="https://listenbrainz.org/{{ entity }}/{{ mbid }}" target="_blank">
      {{ name|upper|e }}
    </a>
    <title>{{ name|e }}</title>
  {%- else -%}
    {{ name|upper|e }}
    <title>{{ name|e }}</title>
  {%- endif -%}
{% endmacro %}

{% macro render_image_link(entity, image) %}
  {% if image.entity_mbid %}
  <a href="https://listenbrainz.org/{{ entity }}/{{ image.entity_mbid }}" target="_blank">
  {% endif %}
    <image
        x="{{ image.x }}"
        y="{{ image.y }}"
        width="{{ image.width }}"
        height="{{ image.height }}"
        preserveAspectRatio="xMidYMid slice"
        href="{{ image.url }}">
        {% if image.title and image.artist %}
        <title>
          {{- image.title|escape ~ " - " ~ image.artist|escape -}}
        </title>
        {% endif %}
    </image>
    {% if image.title and image.artist %}
      <g class="caption" transform="translate({{ image.x }}, {{ image.y + image.height - 40 }})">
        <rect fill="#0000007a" width="{{image.width}}" height="40" ></rect>
        <text>
          <tspan dx="10" dy="20">
            {{- image.title|escape ~ " - " ~ image.artist|escape -}}
          </tspan>
        </text>  
      </g>
    {% endif %}
  {% if image.entity_mbid %}
  </a>
  {% endif %}
{% endmacro %}
